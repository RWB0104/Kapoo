---
title: "[Ubuntu] Ubuntu에서 Key로만 SSH, SFTP 허용하기"
excerpt: ""
coverImage: "https://user-images.githubusercontent.com/50317129/120028591-d5ece480-c02f-11eb-88f0-e14fc647dd81.png"
date: "2021-05-21T21:38:17"
type: "posts"
category: "Ubuntu"
tag: [ "Ubuntu", "SSH", "SFTP" ]
comment: true
publish: true
---

# 개요

SSH, SFTP와 같은 원격 프로토콜은 서버의 접근성을 향상시켜주지만, 서버의 보안성을 극도로 해치게 된다.

공격자가 특정 서버의 IP를 알아냈을 경우, 해당 IP로 SSH 접속 시도를 할 수 있다. 굳이 IP가 아니더라도 해당 IP와 연결된 도메인을 통해서도 얼마든지 가능하다. 특정 도메인의 정보를 DNS서버에 요청하여 IP는 물론 소유자 정보까지 쉽게 취득할 수 있기 때문이다.

내가 접속하려는 서버의 IP 혹은 도메인, SSH 서비스 포트, 게정정보를 알고 있다면 얼마든지 SSH 접속 시도를 할 수 있다.

외부에 도메인을 공개하는 순간 국내는 물론 외국에서 여러 접속 시도가 들어오기도 한다. 특히 중국에서의 공격이 많이 들어오며, 인터넷에서 이와 관련된 경험담이나 피해사례를 어렵지않게 찾아볼 수 있다.

단순히 재미삼아 내가 접속한 도메인에 접속시도를 하는 어중이떠중이들도 있겠지만, 그 중 몇몇은 공격자로 취급할 수 있을 정도의 실력을 가지기도 하며, 그 중에서도 극소수의 몇몇은 내 서버의 보안을 우회할 수 있을 정도의 실력을 가지고 있을 수도 있다.

서버의 특성 상 여러 내부 시스템 및 네트워크와 연결되어 있으므로, 서버가 뜷리는 것은 그 서버와 연관된 각종 정보들의 안전을 보장할 수 없다는 뜻이다. 실제로 각종 보안대책을 강구하는 기업에서도 간혹 이러한 공격에 피해를 입기도 한다. 우스갯소리로 이미 대다수의 자국민 주민등록번호는 인터넷에 나뒹굴고 있을거라고 얘기하기도 할 정도니.

기업처럼 높은 수준의 보안과 수준에 맞는 지식을 가진 담당자가 있을 경우 피해 확인 및 보완이라도 할 수 있겠지만, 보안에 무감각하거나 관련 지식이 미흡한 소규모 사업장이나 개인의 경우 자신의 서버가 피해를 입었다는 사실조차 인지하지 못 하기도 한다. 심할 경우 서버 관리조차 이루어지지 않아 공격자의 개인 서버로 사용되기까지 한다.

그 어떤 보안대첵을 강구해도 보안은 언제나 부족하다. 하지만 간단한 조치만으로도 앞서 언급한 위협의 상당부분을 차단할 수 있다. 말했듯이 대부분은 공격자라고 부르기도 뭐한 장난섞인 시도이며, 상대적으로 낮은 가치의 데이터가 대다수인 개인 서버가 일정 수준의 보안을 갖추고 있을 경우 이를 우회하는 것은 시간낭비이기 때문이다.

간단히 말해 여러분이 게임을 하는데 체력은 많고 패턴도 귀찮은데다, 보상은 잡몹 수준인 보스가 있다고 가정하자. 해당 구간에 도달할 때마다 한숨만 나올 것이며, 게임 커뮤니티엔 해당 보스를 삭제해달라는 요구가 빗발칠 것이다. 유튜브 영상 중 올라온 "역대 최악의 게임 보스 TOP 10"에 당당히 이름이 올라가있다. 또한 DC의 해당 게임 갤러리나 인벤에선 그 보스의 이름을 비하의 의미로 사용하고 있을 것이며, 해당 보스를 스킵할 수 있는 각종 연구들이 활발하게 진행되고 있을 것이다.

이 장에선 우리의 서버를 이런 "보상은 없고 패턴은 귀찮은 체력돼지" 보스로 만들어 공격자들이 드러워서 피하게 만들어 볼 것이다.

# 서비스 포트 변경하기

파일 시스템에 직접적으로 영향을 주는 통신은 SSH, SFTP가 존재한다. 각 프로토콜의 전신인 Telnet과 FTP는 SSL의 미적용으로 OS 설치 시 비활성화 되어있다. 굳이 해당 프로토콜을 쓸 이유조차 없으니, 여기서는 논외로 한다.

* SSH - 
+ SFTP -

각 서비스 포트는 위와 같다. 이와 같은 기본 프로토콜의 포트는 항상 기본값이 정해져있으므로, 대부분의 공격 시도는 해당 프로토콜의 기본 서비스 포트를 통해 이루어진다. 반대로 말하자면, 서비스 포트를 변경하는 것만으로도 공격의 대부분을 차단할 수 있다.

SSH의 22라는 기본 포트와 달리, 서버 담당자가 임의로 바꾼 포트는 추적할 방법이 없기 때문. 포트의 최대값은 65535개이므로, 일일히 요청을 시도하여 SSH 접속이 되는지 확인하는 작업을 강제할 수 있다.

SSH와 SFTP의 서비스 포트를 변경해도 되나, 굳이 그럴 필요 없이 포트 포워딩을 통해 외부 접속 포트만 변경하는 편이 쉽고 빠르다.

``` bash

```

위 명령어를 사용하여 각각의 외부 포트를 내부로 연결한다. 외부에서 해당 포트로 통신해야 내부에서 22번 포트로 연결되기 때문에, SSH의 서비스 포트를 바꿀 필요가 없다.

# IP 대역폭 제한하기

특정 IP 혹은 IP 대역만 접근할 수 있도록 설정한다.

